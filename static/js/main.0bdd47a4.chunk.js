(this["webpackJsonp@video-editor/web"]=this["webpackJsonp@video-editor/web"]||[]).push([[0],{606:function(e,t){},607:function(e,t){},608:function(e,t){},609:function(e,t){},610:function(e,t){},611:function(e,t){},615:function(e,t,n){},616:function(e,t,n){"use strict";n.r(t);n(291),n(482);var r,i,c=n(0),o=n.n(c),a=n(134),u=n.n(a),l=n(5),s=n(15),d=n(10);!function(e){e[e.NORMAL=0]="NORMAL",e[e.NEON=1]="NEON"}(r||(r={})),function(e){e[e.INITIAL=0]="INITIAL",e[e.TEXT=1]="TEXT",e[e.DRAW=2]="DRAW",e[e.IMAGE_UPLOAD=3]="IMAGE_UPLOAD",e[e.DUO_UPLOAD=4]="DUO_UPLOAD",e[e.SOUND_CHANGE=5]="SOUND_CHANGE",e[e.VIDEO_TRIM=6]="VIDEO_TRIM",e[e.AUDIO_TRIM=7]="AUDIO_TRIM",e[e.EXPORTING=8]="EXPORTING"}(i||(i={}));var f=Object(s.b)({key:"scriptState",default:{}}),b=Object(s.b)({key:"pageState",default:i.INITIAL}),v=Object(s.b)({key:"variablesState",default:{FPS:30,videoUrl:"",videoDuration:11.863,isDrawing:!1,erasing:!1,playVideo:!1,pinnedFrame:void 0,exportedVideoUrl:void 0}}),j=(Object(s.b)({key:"textOptionsState",default:{color:"#FFFFFF",background:"#272A2BDE",fontFamily:"Arial",fontWeight:500,fontStyle:"normal",textAlign:"center"}}),Object(s.b)({key:"lineOptionsState",default:{color:"#FFFFFF",size:12,type:r.NORMAL}})),h=n(290),O=["#ffffff","#000000","#f44336","#e91e63","#9c27b0","#673ab7","#3f51b5","#2196f3","#03a9f4","#00bcd4","#009688","#4caf50","#8bc34a","#cddc39","#ffeb3b","#ffc107","#ff9800","#ff5722","#795548","#607d8b"],p=n(6),g=function(e){e.canvasRef;var t=Object(s.e)(b),n=Object(s.c)(v),r=Object(d.a)(n,2),o=(r[0],r[1]),a=Object(s.c)(j),u=Object(d.a)(a,2),f=u[0],g=u[1];return Object(c.useEffect)((function(){o((function(e){return Object(l.a)(Object(l.a)({},e),{},{isDrawing:!0})}))}),[]),Object(p.jsxs)("div",{children:[Object(p.jsx)("button",{onClick:function(){return o((function(e){return Object(l.a)(Object(l.a)({},e),{},{isDrawing:!1})})),t(i.INITIAL)},type:"button",children:"Exit"}),Object(p.jsx)("button",{onClick:function(){return o((function(e){return Object(l.a)(Object(l.a)({},e),{},{erasing:!0})}))},type:"button",children:"Erasing"}),Object(p.jsx)("button",{onClick:function(){return o((function(e){return Object(l.a)(Object(l.a)({},e),{},{erasing:!1})}))},type:"button",children:"Draw"}),Object(p.jsx)("input",{type:"number",value:f.size,onChange:function(e){return g((function(t){return Object(l.a)(Object(l.a)({},t),{},{size:e.currentTarget.valueAsNumber||0})}))}}),Object(p.jsx)(h.a,{width:"100%",circleSize:22,circleSpacing:10,colors:O,color:f.color,onChangeComplete:function(e){var t=e.hex;return g((function(e){return Object(l.a)(Object(l.a)({},e),{},{color:t})}))}})]})},x=n(9),m=n(29),w=function(e){var t,n,r,c=e.canvasRef,o=e.videoRef,a=Object(s.e)(b),u=Object(s.c)(v),f=Object(d.a)(u,2),j=f[0],h=f[1];return Object(p.jsxs)("div",{children:[Object(p.jsx)("button",{onClick:function(){return a(i.DRAW)},type:"button",children:"Draw"}),Object(p.jsx)("button",{onClick:function(){var e,t,n=o.current,r=null===(e=c.current)||void 0===e?void 0:e.getCanvas(),u=null===(t=c.current)||void 0===t?void 0:t.getFabric();if(n&&r&&u){h((function(e){return Object(l.a)(Object(l.a)({},e),{},{pinnedFrame:void 0,playVideo:!1})})),n.currentTime=0,u.forEachObject((function(e){var t;return!(null!==(t=e.customOptions)&&void 0!==t&&t.permanent)&&e.set("opacity",0)})).requestRenderAll(),n.removeAttribute("style"),n.width=n.videoWidth,n.height=n.videoHeight,n.style.display="none",r.style.display="none";var s=u.getCenter(),d=s.top,f=s.left,b=new m.fabric.Image(n,{objectCaching:!1,left:f,top:d,originX:"center",originY:"center"});b.scaleToHeight(u.height||r.height),u.backgroundImage=b,m.fabric.util.requestAnimFrame((function e(){u.requestRenderAll(),m.fabric.util.requestAnimFrame(e)})),a(i.EXPORTING);var v=r.captureStream(60),j=[],O=new MediaRecorder(v);u.selection=!1,u.forEachObject((function(e){e.selectable=!1})),u.discardActiveObject().requestRenderAll(),O.ondataavailable=function(e){e.data.size>0&&j.push(e.data)},O.onstop=function(){var e=URL.createObjectURL(new Blob(j,{type:"video/mp4"}));n.onended=null,h((function(t){return Object(l.a)(Object(l.a)({},t),{},{exportedVideoUrl:e})})),console.log("recording stopped \n\n\n",e)},O.onerror=function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=console).error.apply(e,["Recorder error"].concat(n))},O.start(),n.play(),n.onended=function(){O.stop()}}},type:"submit",children:"Export"}),Object(p.jsx)("button",{onClick:function(){if(!c.current)return console.log("canvas not initialized");var e=c.current.addText("");return h((function(t){return Object(l.a)(Object(l.a)({},t),{},{textId:e})})),a(i.TEXT)},type:"button",children:"Text"}),Object(p.jsx)("button",{onClick:null===(t=c.current)||void 0===t?void 0:t.clear,type:"button",children:"Clear All"}),Object(p.jsx)("button",{onClick:null===(n=c.current)||void 0===n?void 0:n.undo,type:"button",children:"Undo"}),Object(p.jsx)("button",{onClick:null===(r=c.current)||void 0===r?void 0:r.redo,type:"button",children:"Redo"}),Object(p.jsx)("button",{onClick:function(){var e,t;return console.log(null===(e=c.current)||void 0===e||null===(t=e.getFabric())||void 0===t?void 0:t.toObject(["customOptions"]).objects)},type:"button",children:"To JSON"}),Object(p.jsx)("input",{type:"file",accept:"image/*",onChange:function(e){var t,n,r,i,o=null===(t=c.current)||void 0===t?void 0:t.getFabric(),a=null===(n=c.current)||void 0===n?void 0:n.getCanvas();if(o&&a){if(null!==(r=e.target.files)&&void 0!==r&&r.length&&(null===(i=e.target.files)||void 0===i?void 0:i.length)>3)return alert("Reached max file number");var u,l=Object(x.a)(e.target.files);try{for(l.s();!(u=l.n()).done;){var s=u.value,d=new FileReader;d.onload=function(e){var t,n=null===(t=e.target)||void 0===t?void 0:t.result;n&&m.fabric.Image.fromURL(n.toString(),(function(e){var t=a.width,n=a.height;n<t?e.scaleToHeight(n/2):e.scaleToWidth(t/2),o.add(e).requestRenderAll(),e.center()}))},d.readAsDataURL(s)}}catch(f){l.e(f)}finally{l.f()}}},multiple:!0}),j.playVideo&&!j.pinnedFrame?Object(p.jsx)("button",{onClick:function(){return h((function(e){var t,n;return Object(l.a)(Object(l.a)({},e),{},{playVideo:!1,pinnedFrame:null!==(t=Math.round((null===(n=o.current)||void 0===n?void 0:n.currentTime)*e.FPS))&&void 0!==t?t:1})}))},type:"button",children:"Pin frame"}):Object(p.jsx)("button",{onClick:function(){return h((function(e){return Object(l.a)(Object(l.a)({},e),{},{playVideo:!0,pinnedFrame:void 0})}))},type:"button",children:"Unpin frame"})]})},y=function(e){var t=e.canvasRef,n=Object(s.e)(b),r=Object(s.d)(v).selectedTextId,o=Object(c.useState)(""),a=Object(d.a)(o,2),u=a[0],l=a[1],f=Object(c.useRef)(),j=function(){n(i.INITIAL)};if(!r||!t.current)return j(),Object(p.jsx)(p.Fragment,{children:"Redirecting..."});return Object(p.jsxs)("div",{children:[Object(p.jsx)("button",{onClick:j,type:"button",children:"Exit"}),Object(p.jsx)("textarea",{placeholder:"Text goes here ...",onChange:function(e){var t=e.currentTarget.value.trim();l(t),f.current.text=u.trim()}}),Object(p.jsx)("input",{type:"color",onChange:function(e){return f.current.fill=e.currentTarget.value,e.currentTarget.value}})]})},E=n(64),R=n(619),C=n(79),T=(n(612),n(187)),I=n(289),A=m.fabric.util.createClass(m.fabric.Group,{original:null,erasedPath:null,initialize:function(e,t,n,r){this.original=e,this.erasedPath=t,this.callSuper("initialize",[this.original,this.erasedPath],n,r)},_calcBounds:function(e){var t=[],n=[],r=["tr","br","bl","tl"],i=r.length,c=this.original;c.setCoords(!0);for(var o=0;o<i;o++)t.push(c.oCoords[r[o]].x),n.push(c.oCoords[r[o]].y);this._getBounds(t,n,e)}}),D=m.fabric.util.createClass(m.fabric.PencilBrush,{_finalizeAndAddPath:function(){var e=this;this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var t=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"!==t){var n=this.createPath(t);n.globalCompositeOperation="destination-out",n.selectable=!1,n.evented=!1,n.absolutePositioned=!0;var r=this.canvas.getObjects().filter((function(e){return!!e.intersectsWithObject(n)}));if(r.length>0){var i=new m.fabric.Group(r),c=new A(i,n),o=c.left,a=c.top,u=c.toDataURL({withoutTransform:!0});m.fabric.Image.fromURL(u,(function(t){var n;t.set({left:o,top:a}),(n=e.canvas).remove.apply(n,Object(E.a)(r)),e.canvas.add(t)}))}this.canvas.clearContext(this.canvas.contextTop),this.canvas.renderAll(),this._resetShadow()}else this.canvas.requestRenderAll()}}),F=document.createElement("img");F.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3E%3Csvg version='1.1' id='Ebene_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='595.275px' height='595.275px' viewBox='200 215 230 470' xml:space='preserve'%3E%3Ccircle style='fill:%23F44336;' cx='299.76' cy='439.067' r='218.516'/%3E%3Cg%3E%3Crect x='267.162' y='307.978' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -222.6202 340.6915)' style='fill:white;' width='65.545' height='262.18'/%3E%3Crect x='266.988' y='308.153' transform='matrix(0.7071 0.7071 -0.7071 0.7071 398.3889 -83.3116)' style='fill:white;' width='65.544' height='262.179'/%3E%3C/g%3E%3C/svg%3E";var P,N;C.fabric.Object.prototype.controls.deleteControl=new C.fabric.Control({x:.5,y:-.5,offsetY:-16,offsetX:16,cursorStyle:"pointer",withConnection:!0,mouseUpHandler:function(e,t){var n=t.target,r=n.canvas;return!!r&&(r.remove(n),r.requestRenderAll(),!0)},render:(P=F,N=24,function(e,t,n,r,i){var c=N;e.save(),e.translate(t,n),e.rotate(C.fabric.util.degreesToRadians(i.angle||0)),e.drawImage(P,-c/2,-c/2,c,c),e.restore()})});var L=o.a.forwardRef((function(e,t){e.onTextDoubleClick;var n=e.videoRef,r=Object(s.d)(j),o=Object(s.c)(v),a=Object(d.a)(o,2),u=a[0],h=(a[1],Object(s.c)(f)),O=Object(d.a)(h,2),g=O[0],m=O[1],w=Object(s.c)(b),y=Object(d.a)(w,2),A=y[0],F=(y[1],Object(c.useRef)(u)),P=Object(c.useRef)(g),N=Object(c.useRef)(A),L=Object(c.useRef)(null),k=Object(c.useRef)(),S=function(){var e=n.current;if(L.current&&k.current&&e&&N.current!==i.EXPORTING){var t=document.getElementById("video_editor_canvas_container_1"),r=(null===t||void 0===t?void 0:t.clientWidth)||window.innerWidth,c=(null===t||void 0===t?void 0:t.clientHeight)||window.innerHeight,o=e.videoWidth/e.videoHeight,a=0;if(r>c*o){e.height=c,e.width=e.height*o;var u=r-e.width;a=u<50?u:50}else e.width=r,e.height=1*e.width/o;var l=e.height,s=e.width+2*a;return L.current.height=l,L.current.width=s,k.current.setHeight(l),k.current.setWidth(s),k.current.calcOffset(),{w:s,h:l}}},U=function(e){for(var t,n,r=null!==(t=null===(n=k.current)||void 0===n?void 0:n.getObjects())&&void 0!==t?t:[],i=0;i<r.length;i++){var c,o=r[i];if((null===o||void 0===o||null===(c=o.customOptions)||void 0===c?void 0:c.id)===e)return o}};return Object(c.useImperativeHandle)(t,(function(){return{clear:function(){var e;return null===(e=k.current)||void 0===e?void 0:e.clear()},undo:function(){var e,t;return null===(e=k.current)||void 0===e||null===(t=e.undo)||void 0===t?void 0:t.call(e)},redo:function(){var e,t;return null===(e=k.current)||void 0===e||null===(t=e.redo)||void 0===t?void 0:t.call(e)},addText:function(e){var t,n=Object(R.a)(),r=new C.fabric.IText(e,{customOptions:{id:n},textAlign:"center",fill:"black",textBackgroundColor:"white",fontWeight:700,fontFamily:"Arial"});return null===(t=k.current)||void 0===t||t.add(r),r.center(),n},getFabric:function(){return k.current},getCanvas:function(){return L.current},getObject:U}})),Object(c.useEffect)((function(){F.current=u,P.current=g,N.current=A}),[u,g,A]),Object(c.useEffect)((function(){k.current&&(k.current.isDrawingMode=u.isDrawing)}),[u.isDrawing]),Object(c.useEffect)((function(){k.current&&(u.erasing?(k.current.freeDrawingBrush=new D(k.current),k.current.freeDrawingBrush.color="#FF0000",k.current.freeDrawingBrush.width=20):(k.current.freeDrawingBrush=new T.PSBrush(k.current),k.current.freeDrawingBrush.color=r.color,k.current.freeDrawingBrush.width=r.size,k.current.freeDrawingBrush.globalCompositeOperation="destination-over"))}),[u.erasing]),Object(c.useEffect)((function(){k.current&&r.color&&!u.erasing&&(k.current.freeDrawingBrush.color=r.color)}),[r.color]),Object(c.useEffect)((function(){k.current&&r.size&&(k.current.freeDrawingBrush.width=r.size)}),[r.size]),Object(c.useEffect)((function(){var e=k.current=new C.fabric.Canvas(L.current),t=new T.PSBrush(e);t.color=r.color,t.width=r.size,e.freeDrawingBrush=t,n.current&&(n.current.onloadedmetadata=S),window.addEventListener("resize",S,!1);var c=function(e){console.log("object selected",e.target||e.path)};return e.on("selection:created",c),e.on("selection:updated",c),e.on("object:added",(function(t){var n,r=t[t.target?"target":"path"];if(r){if(N.current===i.EXPORTING)return e.remove(r);var c=Object(R.a)(),o=F.current.pinnedFrame,a=Object(l.a)({},P.current),u=!!o;o||(o=1);var s=a[o];if(a[o]=Object(l.a)(Object(l.a)({},s),{},{show:[].concat(Object(E.a)(null!==(n=null===s||void 0===s?void 0:s.show)&&void 0!==n?n:[]),[c])}),u){var d,f=a[o+4];a[o+4]=Object(l.a)(Object(l.a)({},f),{},{hide:[].concat(Object(E.a)(null!==(d=null===f||void 0===f?void 0:f.hide)&&void 0!==d?d:[]),[c])})}m(a);var b={customOptions:{id:c,permanent:!u},dirty:!0,hasControls:!I.isMobile,originX:"center",originY:"center"};for(var v in b)if({}.hasOwnProperty.call(b,v)){var j=v;r.set(j,b[j])}"PSStroke"!==r.type&&"path"!==r.type||(r.left=r.width/2+r.left+r.strokeWidth/2,r.top=r.height/2+r.top+r.strokeWidth/2)}})),function(){window.removeEventListener("resize",S,!1),e.clear(),e.removeListeners()}}),[]),Object(c.useEffect)((function(){var e=0,t=function(){e=requestAnimationFrame(r)},r=function(){var e,r,i,c=P.current,o=F.current,a=o.pinnedFrame,u=o.playVideo,l=o.FPS;if(!u||a)return t();var s=c[null!==(e=Math.round((null===(r=n.current)||void 0===r?void 0:r.currentTime)*l))&&void 0!==e?e:1];if(!s)return t();var d,f=Object(x.a)(s.hide||[]);try{for(f.s();!(d=f.n()).done;){var b=d.value,v=U(b);v&&v.set("opacity",0)}}catch(g){f.e(g)}finally{f.f()}var j,h=Object(x.a)(s.show||[]);try{for(h.s();!(j=h.n()).done;){var O=j.value,p=U(O);p&&p.set("opacity",1)}}catch(g){h.e(g)}finally{h.f()}return null===(i=k.current)||void 0===i||i.requestRenderAll(),t()};return t(),function(){cancelAnimationFrame(e)}}),[]),Object(p.jsx)("div",{style:{width:"100%",height:"100%",position:"absolute",zIndex:2},children:Object(p.jsx)("canvas",{ref:L,style:{left:"50%",top:"50%",position:"absolute"},children:"The editor is not supported on this device"})})}));L.displayName="EditCanvas";var k=L,S=o.a.forwardRef((function(e,t){var n=Object(c.useRef)(null),r=Object(s.d)(b),o=Object(s.c)(v),a=Object(d.a)(o,2),u=a[0],f=a[1];return Object(c.useImperativeHandle)(t,(function(){return n.current})),Object(c.useEffect)((function(){var e=n.current;if(e){u.playVideo?e.play():e.pause();var t=!0,c=function(){(t=r===i.EXPORTING||!t)?u.playVideo&&e.play():e.pause()};r!==i.EXPORTING&&document.addEventListener("visibilitychange",c);var o=function(){r!==i.EXPORTING&&(n.current.currentTime=0,n.current.play())};return r!==i.EXPORTING&&e.addEventListener("ended",o),function(){document.removeEventListener("visibilitychange",c),e.removeEventListener("ended",o)}}}),[u.playVideo,r]),Object(c.useEffect)((function(){var e=n.current;if(e){var t=function(){f((function(e){return Object(l.a)(Object(l.a)({},e),{},{playVideo:!0})}))};return e.addEventListener("canplay",t),e.load(),function(){e.removeEventListener("canplay",t)}}}),[]),Object(p.jsx)("div",{children:Object(p.jsx)("video",{src:u.videoUrl,ref:n,muted:!1,style:{position:"absolute",zIndex:1,top:"50%",left:"50%",transform:"translate(-50%, -50%)"}})})}));S.displayName="BackgroundVideo";var U=S,_=function(e){var t=e.videoUrl,n=Object(s.e)(v);return Object(c.useEffect)((function(){n((function(e){return Object(l.a)(Object(l.a)({},e),{},{videoUrl:t})}))}),[]),Object(p.jsx)("div",{id:"video_editor_canvas_container_1",children:Object(p.jsx)(B,{})})},B=function(){var e=Object(c.useState)(!1),t=Object(d.a)(e,2),n=t[0],r=t[1],o=Object(c.useState)(!0),a=Object(d.a)(o,2),u=a[0],l=a[1],f=Object(c.useRef)(null),j=Object(c.useRef)(null),h=Object(s.d)(b),O=Object(s.d)(v);return Object(c.useEffect)((function(){l(!1)}),[]),u?Object(p.jsx)("span",{className:"text-white",children:"Loading..."}):n?O.exportedVideoUrl?Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("span",{className:"text-white",children:"Exported !"}),Object(p.jsx)("video",{src:O.exportedVideoUrl,style:{width:300},controls:!0})]}):Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)("div",{children:[Object(p.jsx)(U,{ref:j}),Object(p.jsx)(k,{ref:f,videoRef:j})]}),Object(p.jsx)("div",{style:{position:"relative",zIndex:3},children:h===i.EXPORTING?Object(p.jsx)("span",{className:"text-white",children:"Exporting ..."}):h===i.INITIAL?Object(p.jsx)(w,{canvasRef:f,videoRef:j}):h===i.DRAW?Object(p.jsx)(g,{canvasRef:f}):h===i.TEXT?Object(p.jsx)(y,{canvasRef:f}):null})]}):Object(p.jsx)("button",{onClick:function(){return r(!0)},type:"button",children:"Start"})},G=(n(615),function(e){return Object(p.jsx)(s.a,{children:Object(p.jsx)(_,Object(l.a)({},e))})}),V=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,620)).then((function(t){var n=t.getCLS,r=t.getFID,i=(t.getFCP,t.getLCP),c=t.getTTFB;n(e),r(e),i(e),c(e)}))};u.a.render(Object(p.jsx)(o.a.StrictMode,{children:Object(p.jsx)(G,{videoUrl:"../src/stories/test.mp4"})}),document.getElementById("root")),V()}},[[616,1,2]]]);
//# sourceMappingURL=main.0bdd47a4.chunk.js.map