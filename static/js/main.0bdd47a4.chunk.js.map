{"version":3,"sources":["helpers/atoms.ts","helpers/defaults.ts","pages/Draw.tsx","pages/Initial.tsx","pages/Text.tsx","helpers/fabircEraserBursh.ts","components/Canvas.tsx","components/Video.tsx","components/Container.tsx","VideoEditor.tsx","reportWebVitals.ts","index.tsx"],"names":["LineTypes","AppScreens","scriptState","atom","key","default","pageState","INITIAL","variablesState","FPS","videoUrl","videoDuration","isDrawing","erasing","playVideo","pinnedFrame","undefined","exportedVideoUrl","lineOptionsState","color","background","fontFamily","fontWeight","fontStyle","textAlign","size","type","NORMAL","DefaultColors","DrawPage","canvasRef","setPage","useSetRecoilState","useRecoilState","setVariables","lineOptions","setLineOptions","useEffect","vars","onClick","value","onChange","ev","opts","currentTarget","valueAsNumber","width","circleSize","circleSpacing","colors","onChangeComplete","hex","InitialPage","videoRef","variables","DRAW","video","current","canvas","getCanvas","fabricCanvas","getFabric","currentTime","forEachObject","obj","customOptions","permanent","set","requestRenderAll","removeAttribute","videoWidth","height","videoHeight","style","display","getCenter","top","left","videoEl","fabric","Image","objectCaching","originX","originY","scaleToHeight","backgroundImage","util","requestAnimFrame","render","EXPORTING","stream","captureStream","chunks","recorder","MediaRecorder","selection","o","selectable","discardActiveObject","ondataavailable","e","data","push","onstop","URL","createObjectURL","Blob","onended","console","log","onerror","err","error","start","play","stop","id","addText","textId","TEXT","clear","undo","redo","toObject","objects","accept","target","files","length","alert","file","reader","FileReader","onload","f","result","fromURL","toString","img","w","h","scaleToWidth","add","center","readAsDataURL","multiple","Math","round","TextPage","selectedTextId","useRecoilValue","useState","text","setText","textObject","useRef","exitPage","placeholder","trim","fill","ErasedGroup","createClass","Group","original","erasedPath","initialize","options","isAlreadyGrouped","this","callSuper","_calcBounds","onlyWidthHeight","aX","aY","props","jLen","setCoords","j","oCoords","x","y","_getBounds","EraserBrush","PencilBrush","_finalizeAndAddPath","contextTop","closePath","decimate","_points","decimatePoints","pathData","convertPointsToSVGPath","join","path","createPath","globalCompositeOperation","evented","absolutePositioned","getObjects","filter","intersectsWithObject","mergedGroup","newPath","newData","toDataURL","withoutTransform","fabricImage","remove","clearContext","renderAll","_resetShadow","deleteImg","document","createElement","src","icon","cornerSize","Object","prototype","controls","deleteControl","Control","offsetY","offsetX","cursorStyle","withConnection","mouseUpHandler","eventData","transform","ctx","styleOverride","fabricObject","save","translate","rotate","degreesToRadians","angle","drawImage","restore","EditCanvas","React","forwardRef","ref","onTextDoubleClick","script","setScript","page","variablesRef","scriptRef","pageRef","fabricCanvasRef","resizeCanvas","container","getElementById","containerWidth","clientWidth","window","innerWidth","containerHeight","clientHeight","innerHeight","videoAspectRatio","padding","spaceLeft","canvasH","canvasW","setHeight","setWidth","calcOffset","getObject","i","object","useImperativeHandle","uuidv4","textbox","IText","textBackgroundColor","isDrawingMode","freeDrawingBrush","PSBrush","Canvas","brush","onloadedmetadata","addEventListener","onObjectSelected","opt","on","scriptClone","hasPinnedFrame","frameScript","show","hideFrameScript","hide","dirty","hasControls","isMobile","tempOptionId","hasOwnProperty","call","optionId","strokeWidth","removeEventListener","removeListeners","localReqAnim","requestAnimationFrame","animate","toHide","toShow","cancelAnimationFrame","position","zIndex","displayName","BackgroundVideo","pause","focused","onVisibilityChange","onEnd","onReady","load","muted","Container","Content","started","setStart","loading","setLoading","className","VideoEditor","args","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getLCP","getFCP","getTTFB","ReactDOM","StrictMode"],"mappings":"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","file":"static/js/main.0bdd47a4.chunk.js","sourcesContent":["import { atom } from \"recoil\";\nimport { IScripting } from \"./types/scripting\";\n\nexport enum LineTypes {\n\tNORMAL,\n\t// TODO: implement neon\n\tNEON,\n}\n\nexport interface ILineOptions {\n\ttype: LineTypes;\n\tsize: number;\n\tcolor: string;\n}\n\nexport interface ITextOptions {\n\tbackground: string;\n\tcolor: string;\n\tfontFamily: string;\n\tfontWeight: number;\n\tfontStyle: string;\n\ttextAlign: \"center\" | \"left\" | \"right\";\n}\n\nexport interface IVariables {\n\t/** The FPS of the video */\n\treadonly FPS: number;\n\n\t/** The initial video url */\n\treadonly videoUrl: string;\n\n\t/** The final video duration */\n\tvideoDuration: number;\n\n\t/** If the user is in draw state (drawing or erasing) */\n\tisDrawing: boolean;\n\n\t/** If the user is erasing */\n\terasing: boolean;\n\n\t/** If the video is playing (when frame is pinned) */\n\tplayVideo: boolean;\n\n\t/** The frame that was pinned */\n\tpinnedFrame?: number | undefined;\n\n\t/** The ID of the selected text */\n\tselectedTextId?: string;\n\n\t/** The blob url of the video when it's exported */\n\texportedVideoUrl?: string | undefined;\n}\n\nexport enum AppScreens {\n\tINITIAL,\n\tTEXT,\n\tDRAW,\n\tIMAGE_UPLOAD,\n\tDUO_UPLOAD,\n\tSOUND_CHANGE,\n\tVIDEO_TRIM,\n\tAUDIO_TRIM,\n\tEXPORTING\n}\n\nexport const scriptState = atom<IScripting>({\n\tkey: \"scriptState\",\n\tdefault: {},\n});\n\nexport const pageState = atom<AppScreens>({\n\tkey: \"pageState\",\n\tdefault: AppScreens.INITIAL,\n});\n\nexport const variablesState = atom<IVariables>({\n\tkey: \"variablesState\",\n\tdefault: {\n\t\tFPS: 30,\n\t\tvideoUrl: \"\",\n\t\t// TODO: Make this dynamic\n\t\tvideoDuration: 11.863,\n\n\t\tisDrawing: false,\n\t\terasing: false,\n\t\tplayVideo: false,\n\n\t\tpinnedFrame: undefined,\n\t\texportedVideoUrl: undefined,\n\t},\n});\n\nexport const textOptionsState = atom<ITextOptions>({\n\tkey: \"textOptionsState\",\n\tdefault: {\n\t\tcolor: \"#FFFFFF\",\n\t\tbackground: \"#272A2BDE\",\n\t\tfontFamily: \"Arial\",\n\t\tfontWeight: 500,\n\t\tfontStyle: \"normal\",\n\t\ttextAlign: \"center\",\n\t},\n});\n\nexport const lineOptionsState = atom<ILineOptions>({\n\tkey: \"lineOptionsState\",\n\tdefault: {\n\t\tcolor: \"#FFFFFF\",\n\t\tsize: 12,\n\t\ttype: LineTypes.NORMAL,\n\t},\n});\n","export const DefaultColors = [\n\t\"#ffffff\",\n\t\"#000000\",\n\t\"#f44336\",\n\t\"#e91e63\",\n\t\"#9c27b0\",\n\t\"#673ab7\",\n\t\"#3f51b5\",\n\t\"#2196f3\",\n\t\"#03a9f4\",\n\t\"#00bcd4\",\n\t\"#009688\",\n\t\"#4caf50\",\n\t\"#8bc34a\",\n\t\"#cddc39\",\n\t\"#ffeb3b\",\n\t\"#ffc107\",\n\t\"#ff9800\",\n\t\"#ff5722\",\n\t\"#795548\",\n\t\"#607d8b\",\n];\n","import React, { useEffect } from \"react\";\nimport { useRecoilState, useSetRecoilState } from \"recoil\";\nimport { CirclePicker, ColorResult } from \"react-color\";\nimport { IEditCanvasRef } from \"../components/Canvas\";\nimport {\n\tAppScreens,\n\tlineOptionsState,\n\tpageState,\n\tvariablesState,\n} from \"../helpers/atoms\";\nimport { DefaultColors } from \"../helpers/defaults\";\n\ninterface Props {\n\tcanvasRef: React.RefObject<IEditCanvasRef>;\n}\n\nexport const DrawPage: React.FC<Props> = ({ canvasRef }) => {\n\tconst setPage = useSetRecoilState(pageState);\n\tconst [_, setVariables] = useRecoilState(variablesState);\n\tconst [lineOptions, setLineOptions] = useRecoilState(lineOptionsState);\n\n\tconst exitPage = () => {\n\t\tsetVariables((vars) =>\n\t\t\t({ ...vars, isDrawing: false }));\n\t\treturn setPage(AppScreens.INITIAL);\n\t};\n\n\tconst colorChangeHandler = ({ hex: color }: ColorResult) =>\n\t\tsetLineOptions((opts) =>\n\t\t\t({\n\t\t\t\t...opts,\n\t\t\t\tcolor,\n\t\t\t}));\n\n\tuseEffect(() => {\n\t\tsetVariables((vars) =>\n\t\t\t({ ...vars, isDrawing: true }));\n\t}, []);\n\n\treturn (\n\t\t<div>\n\t\t\t<button onClick={exitPage} type=\"button\">\n\t\t\t\tExit\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\tonClick={() =>\n\t\t\t\t\tsetVariables((vars) =>\n\t\t\t\t\t\t({ ...vars, erasing: true }))}\n\t\t\t\ttype=\"button\"\n\t\t\t>\n\t\t\t\tErasing\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\tonClick={() =>\n\t\t\t\t\tsetVariables((vars) =>\n\t\t\t\t\t\t({ ...vars, erasing: false }))}\n\t\t\t\ttype=\"button\"\n\t\t\t>\n\t\t\t\tDraw\n\t\t\t</button>\n\t\t\t<input\n\t\t\t\ttype=\"number\"\n\t\t\t\tvalue={lineOptions.size}\n\t\t\t\tonChange={(ev) =>\n\t\t\t\t\tsetLineOptions((opts) =>\n\t\t\t\t\t\t({\n\t\t\t\t\t\t\t...opts,\n\t\t\t\t\t\t\tsize: ev.currentTarget.valueAsNumber || 0,\n\t\t\t\t\t\t}))}\n\t\t\t/>\n\t\t\t<CirclePicker\n\t\t\t\twidth=\"100%\"\n\t\t\t\tcircleSize={22}\n\t\t\t\tcircleSpacing={10}\n\t\t\t\tcolors={DefaultColors}\n\t\t\t\tcolor={lineOptions.color}\n\t\t\t\tonChangeComplete={colorChangeHandler}\n\t\t\t/>\n\t\t</div>\n\t);\n};\n","import React from \"react\";\nimport { useRecoilState, useSetRecoilState } from \"recoil\";\nimport { fabric } from \"fabric\";\nimport { IonButton } from \"@ionic/react\";\nimport { IEditCanvasRef } from \"../components/Canvas\";\nimport { AppScreens, pageState, variablesState } from \"../helpers/atoms\";\n\ninterface Props {\n\tcanvasRef: React.RefObject<IEditCanvasRef>;\n\tvideoRef: React.RefObject<HTMLVideoElement>;\n}\n\nexport const InitialPage: React.FC<Props> = ({ canvasRef, videoRef }) => {\n\tconst setPage = useSetRecoilState(pageState);\n\tconst [variables, setVariables] = useRecoilState(variablesState);\n\n\tconst createText = () => {\n\t\tif (!canvasRef.current)\n\t\t\treturn console.log(\"canvas not initialized\");\n\t\tconst id = canvasRef.current.addText(\"\");\n\t\tsetVariables((vars) =>\n\t\t\t({ ...vars, textId: id }));\n\t\treturn setPage(AppScreens.TEXT);\n\t};\n\n\tconst addImage: React.ChangeEventHandler<HTMLInputElement> = (e) => {\n\t\tconst fabricCanvas = canvasRef.current?.getFabric();\n\t\tconst canvas = canvasRef.current?.getCanvas();\n\n\t\tif (!fabricCanvas || !canvas)\n\t\t\treturn;\n\n\t\tif (e.target.files?.length && e.target.files?.length > 3)\n\t\t// TODO: add this as a prop event and let the user handle it\n\t\t\treturn alert(\"Reached max file number\");\n\n\t\tfor (const file of e.target.files!) {\n\t\t\tconst reader = new FileReader();\n\t\t\treader.onload = (f) => {\n\t\t\t\tconst data = f.target?.result;\n\t\t\t\tif (!data)\n\t\t\t\t\treturn;\n\n\t\t\t\tfabric.Image.fromURL(data.toString(), (img) => {\n\t\t\t\t\tconst w = canvas.width;\n\t\t\t\t\tconst h = canvas.height;\n\n\t\t\t\t\tif (h < w)\n\t\t\t\t\t\timg.scaleToHeight(h / 2);\n\t\t\t\t\telse\n\t\t\t\t\t\timg.scaleToWidth(w / 2);\n\n\t\t\t\t\tfabricCanvas.add(img).requestRenderAll();\n\t\t\t\t\timg.center();\n\t\t\t\t});\n\t\t\t};\n\n\t\t\treader.readAsDataURL(file);\n\t\t}\n\t};\n\n\tconst exportVideo = () => {\n\t\tconst video = videoRef.current;\n\t\tconst canvas = canvasRef.current?.getCanvas();\n\t\tconst fabricCanvas = canvasRef.current?.getFabric();\n\n\t\tconst recordingFPS = 60;\n\n\t\tif (!video || !canvas || !fabricCanvas)\n\t\t\treturn;\n\n\t\tsetVariables((vars) =>\n\t\t\t({ ...vars, pinnedFrame: undefined, playVideo: false }));\n\n\t\tvideo.currentTime = 0;\n\n\t\t// reset the whole canvas\n\t\tfabricCanvas.forEachObject((obj) =>\n\t\t\t!obj.customOptions?.permanent && obj.set(\"opacity\", 0))\n\t\t\t.requestRenderAll();\n\n\t\tvideo.removeAttribute(\"style\");\n\n\t\t// Reset video dimensions. Otherwise, video will be cropped\n\t\tvideo.width = video.videoWidth;\n\t\tvideo.height = video.videoHeight;\n\n\t\t// hide video and canvas\n\t\tvideo.style.display = \"none\";\n\t\tcanvas.style.display = \"none\";\n\n\t\tconst { top, left } = fabricCanvas.getCenter();\n\t\tconst videoEl = new fabric.Image(video, {\n\t\t\tobjectCaching: false,\n\n\t\t\tleft,\n\t\t\ttop,\n\n\t\t\toriginX: \"center\",\n\t\t\toriginY: \"center\",\n\t\t});\n\n\t\tvideoEl.scaleToHeight(fabricCanvas.height || canvas.height);\n\n\t\tfabricCanvas.backgroundImage = videoEl;\n\n\t\tfabric.util.requestAnimFrame(function render() {\n\t\t\tfabricCanvas.requestRenderAll();\n\t\t\tfabric.util.requestAnimFrame(render);\n\t\t});\n\n\t\tsetPage(AppScreens.EXPORTING);\n\n\t\tconst stream = canvas.captureStream(recordingFPS);\n\n\t\tconst chunks: Blob[] = [];\n\t\tconst recorder = new MediaRecorder(stream);\n\n\t\tfabricCanvas.selection = false;\n\t\tfabricCanvas.forEachObject((o) => {\n\t\t\to.selectable = false;\n\t\t});\n\t\tfabricCanvas.discardActiveObject().requestRenderAll();\n\n\t\trecorder.ondataavailable = (e) => {\n\t\t\tif (e.data.size > 0)\n\t\t\t\tchunks.push(e.data);\n\t\t};\n\n\t\trecorder.onstop = () => {\n\t\t\tconst videoUrl = URL.createObjectURL(new Blob(chunks, { type: \"video/mp4\" }));\n\t\t\tvideo.onended = null;\n\t\t\tsetVariables((vars) =>\n\t\t\t\t({\n\t\t\t\t\t...vars,\n\t\t\t\t\texportedVideoUrl: videoUrl,\n\t\t\t\t}));\n\n\t\t\tconsole.log(\"recording stopped \\n\\n\\n\", videoUrl);\n\t\t};\n\n\t\trecorder.onerror = (...err) =>\n\t\t\tconsole.error(\"Recorder error\", ...err);\n\n\t\trecorder.start();\n\t\tvideo.play();\n\n\t\tvideo.onended = () => {\n\t\t\trecorder.stop();\n\t\t};\n\t};\n\n\treturn (\n\t\t<div>\n\t\t\t<button\n\t\t\t\tonClick={() =>\n\t\t\t\t\tsetPage(AppScreens.DRAW)}\n\t\t\t\ttype=\"button\"\n\t\t\t>\n\t\t\t\tDraw\n\t\t\t</button>\n\n\t\t\t<button\n\t\t\t\tonClick={exportVideo}\n\t\t\t\ttype=\"submit\"\n\t\t\t>\n\t\t\t\tExport\n\n\t\t\t</button>\n\n\t\t\t<button onClick={createText} type=\"button\">Text</button>\n\t\t\t<button onClick={canvasRef.current?.clear} type=\"button\">Clear All</button>\n\t\t\t<button onClick={canvasRef.current?.undo} type=\"button\">Undo</button>\n\t\t\t<button onClick={canvasRef.current?.redo} type=\"button\">Redo</button>\n\t\t\t<button\n\t\t\t\tonClick={() =>\n\t\t\t\t\tconsole.log(\n\t\t\t\t\t\tcanvasRef.current?.getFabric()?.toObject([\"customOptions\"]).objects,\n\t\t\t\t\t)}\n\t\t\t\ttype=\"button\"\n\t\t\t>\n\t\t\t\tTo JSON\n\t\t\t</button>\n\n\t\t\t<input type=\"file\" accept=\"image/*\" onChange={addImage} multiple />\n\t\t\t{variables.playVideo && !variables.pinnedFrame ? (\n\t\t\t\t<button\n\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\tsetVariables((vars) =>\n\t\t\t\t\t\t\t({\n\t\t\t\t\t\t\t\t...vars,\n\t\t\t\t\t\t\t\tplayVideo: false,\n\t\t\t\t\t\t\t\tpinnedFrame:\n\t\t\t\t\t\t\t\tMath.round(\n\t\t\t\t\t\t\t\t\tvideoRef.current?.currentTime! * vars.FPS,\n\t\t\t\t\t\t\t\t) ?? 1,\n\t\t\t\t\t\t\t}))}\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t>\n\t\t\t\t\tPin frame\n\t\t\t\t</button>\n\t\t\t) : (\n\t\t\t\t<button\n\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\tsetVariables((vars) =>\n\t\t\t\t\t\t\t({\n\t\t\t\t\t\t\t\t...vars,\n\t\t\t\t\t\t\t\tplayVideo: true,\n\t\t\t\t\t\t\t\tpinnedFrame: undefined,\n\t\t\t\t\t\t\t}))}\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t>\n\t\t\t\t\tUnpin frame\n\t\t\t\t</button>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n","import React, {\n\tChangeEventHandler, useRef, useState,\n} from \"react\";\nimport { useRecoilValue, useSetRecoilState } from \"recoil\";\nimport { IEditCanvasRef } from \"../components/Canvas\";\nimport { AppScreens, pageState, variablesState } from \"../helpers/atoms\";\n\ninterface Props {\n\tcanvasRef: React.RefObject<IEditCanvasRef>;\n}\n\nexport const TextPage: React.FC<Props> = ({ canvasRef }) => {\n\t// global state\n\tconst setPage = useSetRecoilState(pageState);\n\tconst { selectedTextId } = useRecoilValue(variablesState)!;\n\n\t// local state\n\tconst [text, setText] = useState<string>(\"\");\n\tconst textObject = useRef<fabric.IText>();\n\n\tconst exitPage = () => {\n\t\tsetPage(AppScreens.INITIAL);\n\t};\n\n\tif (!selectedTextId || !canvasRef.current) {\n\t\texitPage();\n\t\treturn <>Redirecting...</>;\n\t}\n\n\t// useEffect(() => {\n\t// \ttextObject.current = canvasRef.current?.getObject(selectedTextId) as\n\t// \t\t| fabric.IText\n\t// \t\t| undefined;\n\t// \tsetText(textObject.current!.text ?? \"\");\n\n\t// \t// hide object\n\t// \ttextObject.current!.opacity = 0;\n\t// \tcanvasRef.current?.getFabric()?.renderAll();\n\n\t// \t// show object\n\t// \treturn () => {\n\t// \t\ttextObject.current!.opacity = 1;\n\t// \t\tcanvasRef.current?.getFabric()?.renderAll();\n\t// \t};\n\t// }, []);\n\n\tconst changeObjectValue = (newText: string) => {\n\t\ttextObject.current!.text = text.trim();\n\t};\n\n\tconst textChangeHandler: ChangeEventHandler<HTMLTextAreaElement> = (ev) => {\n\t\tconst value = ev.currentTarget.value.trim();\n\t\tsetText(value);\n\t\treturn changeObjectValue(value);\n\t};\n\n\tconst colorChangeHandler: ChangeEventHandler<HTMLInputElement> = (ev) => {\n\t\ttextObject.current!.fill = ev.currentTarget.value;\n\t\treturn ev.currentTarget.value;\n\t};\n\n\treturn (\n\t\t<div>\n\t\t\t<button onClick={exitPage} type=\"button\">Exit</button>\n\t\t\t<textarea\n\t\t\t\tplaceholder=\"Text goes here ...\"\n\t\t\t\tonChange={textChangeHandler}\n\t\t\t/>\n\t\t\t<input type=\"color\" onChange={colorChangeHandler} />\n\t\t</div>\n\t);\n};\n","// Source: https://github.com/fabricjs/fabric.js/issues/1225#issuecomment-499620550\n\nimport { fabric } from \"fabric\";\n\n/*\n * Note: Might not work with versions other than 3.1.0\n *\n * Made it so that the bound is calculated on the original only\n */\nconst ErasedGroup = fabric.util.createClass(fabric.Group, {\n\toriginal: null,\n\terasedPath: null,\n\tinitialize(\n\t\toriginal: any,\n\t\terasedPath: any,\n\t\toptions: any,\n\t\tisAlreadyGrouped: any,\n\t) {\n\t\tthis.original = original;\n\t\tthis.erasedPath = erasedPath;\n\t\tthis.callSuper(\n\t\t\t\"initialize\",\n\t\t\t[this.original, this.erasedPath],\n\t\t\toptions,\n\t\t\tisAlreadyGrouped,\n\t\t);\n\t},\n\n\t_calcBounds(onlyWidthHeight: any) {\n\t\tconst aX = [];\n\t\tconst aY = [];\n\t\tconst props = [\"tr\", \"br\", \"bl\", \"tl\"];\n\t\tconst jLen = props.length;\n\t\tconst ignoreZoom = true;\n\n\t\tconst o = this.original;\n\t\to.setCoords(ignoreZoom);\n\t\tfor (let j = 0; j < jLen; j++) {\n\t\t\taX.push(o.oCoords[props[j]].x);\n\t\t\taY.push(o.oCoords[props[j]].y);\n\t\t}\n\n\t\tthis._getBounds(aX, aY, onlyWidthHeight);\n\t},\n});\n\n/*\n * Note1: Might not work with versions other than 3.1.0\n *\n * Made it so that the path will be 'merged' with other objects\n *  into a customized group and has a 'destination-out' composition\n */\nexport const EraserBrush = fabric.util.createClass(fabric.PencilBrush, {\n\t/**\n\t * On mouseup after drawing the path on contextTop canvas\n\t * we use the points captured to create an new fabric path object\n\t * and add it to the fabric canvas.\n\t */\n\t_finalizeAndAddPath() {\n\t\tconst ctx = this.canvas.contextTop;\n\t\tctx.closePath();\n\t\tif (this.decimate)\n\t\t\tthis._points = this.decimatePoints(this._points, this.decimate);\n\n\t\tconst pathData = this.convertPointsToSVGPath(this._points).join(\"\");\n\t\tif (pathData === \"M 0 0 Q 0 0 0 0 L 0 0\") {\n\t\t\t// do not create 0 width/height paths, as they are\n\t\t\t// rendered inconsistently across browsers\n\t\t\t// Firefox 4, for example, renders a dot,\n\t\t\t// whereas Chrome 10 renders nothing\n\t\t\tthis.canvas.requestRenderAll();\n\t\t\treturn;\n\t\t}\n\n\t\t// use globalCompositeOperation to 'fake' eraser\n\t\tconst path = this.createPath(pathData);\n\t\tpath.globalCompositeOperation = \"destination-out\";\n\t\tpath.selectable = false;\n\t\tpath.evented = false;\n\t\tpath.absolutePositioned = true;\n\n\t\t// grab all the objects that intersects with the path\n\t\tconst objects = this.canvas\n\t\t\t.getObjects()\n\t\t\t.filter((obj: fabric.Object) => {\n\t\t\t\t// if (obj instanceof fabric.Textbox) return false;\n\t\t\t\t// if (obj instanceof fabric.IText) return false;\n\t\t\t\tif (!obj.intersectsWithObject(path))\n\t\t\t\t\treturn false;\n\t\t\t\treturn true;\n\t\t\t});\n\n\t\tif (objects.length > 0) {\n\t\t\t// merge those objects into a group\n\t\t\tconst mergedGroup = new fabric.Group(objects);\n\n\t\t\t// This will perform the actual 'erasing'\n\t\t\t// NOTE: you can do this for each object, instead of doing it with a merged group\n\t\t\t// however, there will be a visible lag when there's many objects affected by this\n\t\t\tconst newPath = new ErasedGroup(mergedGroup, path);\n\n\t\t\tconst { left } = newPath;\n\t\t\tconst { top } = newPath;\n\n\t\t\t// convert it into a dataURL, then back to a fabric image\n\t\t\tconst newData = newPath.toDataURL({\n\t\t\t\twithoutTransform: true,\n\t\t\t});\n\t\t\tfabric.Image.fromURL(newData, (fabricImage) => {\n\t\t\t\tfabricImage.set({\n\t\t\t\t\tleft,\n\t\t\t\t\ttop,\n\t\t\t\t});\n\n\t\t\t\t// remove the old objects then add the new image\n\t\t\t\tthis.canvas.remove(...objects);\n\t\t\t\tthis.canvas.add(fabricImage);\n\t\t\t});\n\t\t}\n\n\t\tthis.canvas.clearContext(this.canvas.contextTop);\n\t\tthis.canvas.renderAll();\n\t\tthis._resetShadow();\n\t},\n});\n","/* eslint-disable react/require-default-props */\nimport React, { useEffect, useImperativeHandle, useRef } from \"react\";\nimport { useRecoilState, useRecoilValue } from \"recoil\";\nimport { v4 as uuidv4 } from \"uuid\";\n\n// Fabric JS\nimport { fabric } from \"fabric-with-gestures\";\nimport \"fabric-history\";\n\n// Brushes\nimport { PSBrush } from \"@arch-inc/fabricjs-psbrush\";\nimport { isMobile } from \"react-device-detect\";\nimport { EraserBrush } from \"../helpers/fabircEraserBursh\";\n\n// Helpers\nimport {\n\tvariablesState,\n\tlineOptionsState,\n\tscriptState,\n\tIVariables,\n\tpageState,\n\tAppScreens,\n} from \"../helpers/atoms\";\nimport { IScripting } from \"../helpers/types/scripting\";\n\nconst deleteObject: fabric.Control[\"mouseUpHandler\"] = (eventData, transform) => {\n\tconst { target } = transform;\n\tconst { canvas } = target;\n\n\tif (!canvas)\n\t\treturn false;\n\n\tcanvas.remove(target);\n\tcanvas.requestRenderAll();\n\treturn true;\n};\n\nconst deleteIcon = \"data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3E%3Csvg version='1.1' id='Ebene_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='595.275px' height='595.275px' viewBox='200 215 230 470' xml:space='preserve'%3E%3Ccircle style='fill:%23F44336;' cx='299.76' cy='439.067' r='218.516'/%3E%3Cg%3E%3Crect x='267.162' y='307.978' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -222.6202 340.6915)' style='fill:white;' width='65.545' height='262.18'/%3E%3Crect x='266.988' y='308.153' transform='matrix(0.7071 0.7071 -0.7071 0.7071 398.3889 -83.3116)' style='fill:white;' width='65.544' height='262.179'/%3E%3C/g%3E%3C/svg%3E\";\n\nconst deleteImg = document.createElement(\"img\");\ndeleteImg.src = deleteIcon;\n\nconst renderIcon = (icon: HTMLImageElement, cornerSize: number): fabric.Control[\"render\"] =>\n\t(ctx, left, top, styleOverride, fabricObject) => {\n\t\tconst size = cornerSize;\n\t\tctx.save();\n\t\tctx.translate(left, top);\n\t\tctx.rotate(fabric.util.degreesToRadians(fabricObject.angle || 0));\n\t\tctx.drawImage(icon, -size / 2, -size / 2, size, size);\n\t\tctx.restore();\n\t};\n\nfabric.Object.prototype.controls.deleteControl = new fabric.Control({\n\tx: 0.5,\n\ty: -0.5,\n\toffsetY: -16,\n\toffsetX: 16,\n\tcursorStyle: \"pointer\",\n\twithConnection: true,\n\tmouseUpHandler: deleteObject,\n\trender: renderIcon(deleteImg, 24),\n});\n\ninterface Props {\n\tonTextDoubleClick?: (obj: any) => any;\n\tvideoRef: React.RefObject<HTMLVideoElement>;\n}\n\ntype TFabricRef = fabric.Canvas | null | undefined;\ntype TCanvasRef = HTMLCanvasElement | null | undefined;\n\nexport interface IEditCanvasRef {\n\tclear?: () => void;\n\tundo?: () => void;\n\tredo?: () => void;\n\taddText: (text: string) => string;\n\tgetObject: (id: string) => fabric.Object | undefined;\n\tgetFabric: () => TFabricRef;\n\tgetCanvas: () => TCanvasRef;\n}\n\nconst EditCanvas = React.forwardRef<IEditCanvasRef, Props>(\n\t({ onTextDoubleClick = null, videoRef }, ref) => {\n\t\tconst lineOptions = useRecoilValue(lineOptionsState);\n\t\tconst [variables, setVariables] = useRecoilState(variablesState);\n\t\tconst [script, setScript] = useRecoilState(scriptState);\n\t\tconst [page, setPage] = useRecoilState(pageState);\n\n\t\tconst variablesRef = useRef<IVariables>(variables);\n\t\tconst scriptRef = useRef<IScripting>(script);\n\t\tconst pageRef = useRef<AppScreens>(page);\n\n\t\tconst canvasRef = useRef<HTMLCanvasElement>(null);\n\t\tconst fabricCanvasRef = useRef<fabric.Canvas>();\n\n\t\tconst resizeCanvas = () => {\n\t\t\tconst video = videoRef.current;\n\n\t\t\tif (\n\t\t\t\t!canvasRef.current\n\t\t\t\t|| !fabricCanvasRef.current\n\t\t\t\t|| !video\n\t\t\t\t|| pageRef.current === AppScreens.EXPORTING\n\t\t\t)\n\t\t\t\treturn;\n\n\t\t\tconst container = document.getElementById(\"video_editor_canvas_container_1\");\n\n\t\t\tconst containerWidth = container?.clientWidth || window.innerWidth;\n\t\t\tconst containerHeight = container?.clientHeight || window.innerHeight;\n\n\t\t\tconst videoAspectRatio = video.videoWidth / video.videoHeight;\n\n\t\t\tconst maxPadding: number = 50;\n\n\t\t\t/** The padding in `px` the canvas will have compared to the video */\n\t\t\tlet padding: number = 0;\n\n\t\t\tif (containerWidth > containerHeight * videoAspectRatio) {\n\t\t\t\tvideo.height = containerHeight;\n\t\t\t\tvideo.width = video.height * videoAspectRatio;\n\n\t\t\t\t// ideally the canvas has a 50px padding\n\t\t\t\tconst spaceLeft = containerWidth - video.width;\n\t\t\t\tpadding = spaceLeft < maxPadding ? spaceLeft : maxPadding;\n\t\t\t} else {\n\t\t\t\tvideo.width = containerWidth;\n\t\t\t\tvideo.height = video.width * 1 / videoAspectRatio;\n\t\t\t}\n\n\t\t\tconst canvasH = video.height;\n\t\t\tconst canvasW = video.width + padding * 2;\n\n\t\t\tcanvasRef.current.height = canvasH;\n\t\t\tcanvasRef.current.width = canvasW;\n\n\t\t\tfabricCanvasRef.current.setHeight(canvasH);\n\t\t\tfabricCanvasRef.current.setWidth(canvasW);\n\t\t\tfabricCanvasRef.current.calcOffset();\n\n\t\t\treturn { w: canvasW, h: canvasH };\n\t\t};\n\n\t\tconst getObject = (id: string) => {\n\t\t\tconst objects = fabricCanvasRef.current?.getObjects() ?? [];\n\n\t\t\tfor (let i = 0; i < objects.length; i++) {\n\t\t\t\tconst object = objects[i];\n\t\t\t\tif (object?.customOptions?.id === id)\n\t\t\t\t\treturn object;\n\t\t\t}\n\t\t};\n\n\t\tuseImperativeHandle(ref, () =>\n\t\t\t({\n\t\t\t\tclear: () =>\n\t\t\t\t\tfabricCanvasRef.current?.clear(),\n\t\t\t\tundo: () =>\n\t\t\t\t\tfabricCanvasRef.current?.undo?.(),\n\t\t\t\tredo: () =>\n\t\t\t\t\tfabricCanvasRef.current?.redo?.(),\n\t\t\t\taddText: (text) => {\n\t\t\t\t\tconst id = uuidv4();\n\t\t\t\t\tconst textbox = new fabric.IText(text, {\n\t\t\t\t\t\tcustomOptions: {\n\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttextAlign: \"center\",\n\t\t\t\t\t\tfill: \"black\",\n\t\t\t\t\t\ttextBackgroundColor: \"white\",\n\t\t\t\t\t\tfontWeight: 700,\n\t\t\t\t\t\tfontFamily: \"Arial\",\n\t\t\t\t\t});\n\n\t\t\t\t\tfabricCanvasRef.current?.add(textbox);\n\t\t\t\t\ttextbox.center();\n\t\t\t\t\treturn id;\n\t\t\t\t},\n\t\t\t\tgetFabric: () =>\n\t\t\t\t\tfabricCanvasRef.current,\n\t\t\t\tgetCanvas: () =>\n\t\t\t\t\tcanvasRef.current,\n\t\t\t\tgetObject,\n\t\t\t}));\n\n\t\tuseEffect(() => {\n\t\t\tvariablesRef.current = variables;\n\t\t\tscriptRef.current = script;\n\t\t\tpageRef.current = page;\n\t\t}, [variables, script, page]);\n\n\t\tuseEffect(() => {\n\t\t\tif (fabricCanvasRef.current)\n\t\t\t\tfabricCanvasRef.current.isDrawingMode = variables.isDrawing;\n\t\t}, [variables.isDrawing]);\n\n\t\tuseEffect(() => {\n\t\t\tif (!fabricCanvasRef.current)\n\t\t\t\treturn;\n\t\t\tif (variables.erasing) {\n\t\t\t\tfabricCanvasRef.current.freeDrawingBrush = new EraserBrush(\n\t\t\t\t\tfabricCanvasRef.current,\n\t\t\t\t);\n\t\t\t\tfabricCanvasRef.current.freeDrawingBrush.color = \"#FF0000\";\n\t\t\t\tfabricCanvasRef.current.freeDrawingBrush.width = 20;\n\t\t\t} else {\n\t\t\t\tfabricCanvasRef.current.freeDrawingBrush = new PSBrush(\n\t\t\t\t\tfabricCanvasRef.current,\n\t\t\t\t);\n\t\t\t\tfabricCanvasRef.current.freeDrawingBrush.color = lineOptions.color;\n\t\t\t\tfabricCanvasRef.current.freeDrawingBrush.width = lineOptions.size;\n\t\t\t\tfabricCanvasRef.current.freeDrawingBrush.globalCompositeOperation =\t\t\t\t\t\"destination-over\";\n\t\t\t}\n\t\t}, [variables.erasing]);\n\n\t\tuseEffect(() => {\n\t\t\tif (\n\t\t\t\tfabricCanvasRef.current\n\t\t\t\t&& lineOptions.color\n\t\t\t\t&& !variables.erasing\n\t\t\t)\n\t\t\t\tfabricCanvasRef.current.freeDrawingBrush.color = lineOptions.color;\n\t\t}, [lineOptions.color]);\n\n\t\tuseEffect(() => {\n\t\t\tif (fabricCanvasRef.current && lineOptions.size)\n\t\t\t\tfabricCanvasRef.current.freeDrawingBrush.width = lineOptions.size;\n\t\t}, [lineOptions.size]);\n\n\t\tuseEffect(() => {\n\t\t\t// init fabric.js\n\t\t\tconst canvas = fabricCanvasRef.current = new fabric.Canvas(\n\t\t\t\tcanvasRef.current,\n\t\t\t);\n\n\t\t\t// init pressure brush\n\t\t\tconst brush = new PSBrush(canvas);\n\t\t\tbrush.color = lineOptions.color;\n\t\t\tbrush.width = lineOptions.size;\n\t\t\tcanvas.freeDrawingBrush = brush;\n\n\t\t\tif (videoRef.current)\n\t\t\t\tvideoRef.current.onloadedmetadata = resizeCanvas;\n\n\t\t\twindow.addEventListener(\"resize\", resizeCanvas, false);\n\n\t\t\t/** Add controls when object is selected */\n\t\t\tconst onObjectSelected = (opt: fabric.IEvent) => {\n\t\t\t\tconsole.log(\"object selected\", opt.target || opt.path);\n\t\t\t};\n\n\t\t\t// TODO: handle events (onTextDoubleClick)\n\t\t\tcanvas.on(\"selection:created\", onObjectSelected);\n\t\t\tcanvas.on(\"selection:updated\", onObjectSelected);\n\n\t\t\t/** Modify script, add id and other properties to the canvas */\n\t\t\tcanvas.on(\"object:added\", (opt) => {\n\t\t\t\tconst object = opt[opt.target ? \"target\" : \"path\"];\n\n\t\t\t\tif (!object)\n\t\t\t\t\treturn;\n\n\t\t\t\t// if video is currently being exported don't allow new elements\n\t\t\t\tif (pageRef.current === AppScreens.EXPORTING)\n\t\t\t\t\treturn canvas.remove(object);\n\n\t\t\t\tconst id = uuidv4();\n\n\t\t\t\tlet { pinnedFrame } = variablesRef.current;\n\t\t\t\tconst scriptClone = { ...scriptRef.current };\n\t\t\t\tconst hasPinnedFrame: boolean = !!pinnedFrame;\n\n\t\t\t\tif (!pinnedFrame)\n\t\t\t\t\tpinnedFrame = 1;\n\n\t\t\t\tconst frameScript = scriptClone[pinnedFrame];\n\n\t\t\t\tscriptClone[pinnedFrame] = {\n\t\t\t\t\t...frameScript,\n\t\t\t\t\tshow: [...(frameScript?.show ?? []), id],\n\t\t\t\t};\n\n\t\t\t\tif (hasPinnedFrame) {\n\t\t\t\t\tconst nextFrame = 4;\n\t\t\t\t\tconst hideFrameScript = scriptClone[pinnedFrame + nextFrame];\n\n\t\t\t\t\tscriptClone[pinnedFrame + nextFrame] = {\n\t\t\t\t\t\t...hideFrameScript,\n\t\t\t\t\t\thide: [...(hideFrameScript?.hide ?? []), id],\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// add object to script\n\t\t\t\tsetScript(scriptClone);\n\n\t\t\t\tconst options: Partial<fabric.Object> = {\n\t\t\t\t\tcustomOptions: {\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tpermanent: !hasPinnedFrame,\n\t\t\t\t\t},\n\t\t\t\t\tdirty: true,\n\t\t\t\t\thasControls: !isMobile,\n\t\t\t\t\toriginX: \"center\",\n\t\t\t\t\toriginY: \"center\",\n\t\t\t\t};\n\n\t\t\t\t// apply new options on object\n\t\t\t\tfor (const tempOptionId in options)\n\t\t\t\t\tif ({}.hasOwnProperty.call(options, tempOptionId)) {\n\t\t\t\t\t\tconst optionId = tempOptionId as keyof fabric.Object;\n\t\t\t\t\t\tobject.set(\n\t\t\t\t\t\t\toptionId,\n\t\t\t\t\t\t\toptions[optionId],\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t// replace drawing after it was moved when origin was changed\n\t\t\t\tif (object.type === \"PSStroke\" || object.type === \"path\") {\n\t\t\t\t\tobject.left = ((object.width! / 2) + object.left!) + object.strokeWidth! / 2;\n\t\t\t\t\tobject.top = ((object.height! / 2) + object.top!) + object.strokeWidth! / 2;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn () => {\n\t\t\t\twindow.removeEventListener(\"resize\", resizeCanvas, false);\n\t\t\t\tcanvas.clear();\n\t\t\t\tcanvas.removeListeners();\n\t\t\t};\n\t\t}, []);\n\n\t\tuseEffect(() => {\n\t\t\t/** The next animation frame */\n\t\t\tlet localReqAnim: number = 0;\n\n\t\t\tconst requestAnimFrame = () => {\n\t\t\t\tlocalReqAnim = requestAnimationFrame(animate);\n\t\t\t};\n\n\t\t\tconst animate = () => {\n\t\t\t\tconst script = scriptRef.current;\n\t\t\t\tconst { pinnedFrame, playVideo, FPS } = variablesRef.current;\n\n\t\t\t\tif (!playVideo || pinnedFrame)\n\t\t\t\t\treturn requestAnimFrame();\n\n\t\t\t\tconst frame = Math.round(videoRef.current?.currentTime! * FPS) ?? 1;\n\n\t\t\t\tconst frameScript = script[frame];\n\n\t\t\t\tif (!frameScript)\n\t\t\t\t\treturn requestAnimFrame();\n\n\t\t\t\t// hide objects\n\t\t\t\tfor (const toHide of frameScript.hide || []) {\n\t\t\t\t\tconst obj = getObject(toHide);\n\t\t\t\t\tif (!obj)\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\tobj.set(\"opacity\", 0);\n\t\t\t\t}\n\n\t\t\t\t// show objects\n\t\t\t\tfor (const toShow of frameScript.show || []) {\n\t\t\t\t\tconst obj = getObject(toShow);\n\t\t\t\t\tif (!obj)\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\tobj.set(\"opacity\", 1);\n\t\t\t\t}\n\n\t\t\t\tfabricCanvasRef.current?.requestRenderAll();\n\n\t\t\t\treturn requestAnimFrame();\n\t\t\t};\n\n\t\t\trequestAnimFrame();\n\n\t\t\treturn () => {\n\t\t\t\tcancelAnimationFrame(localReqAnim);\n\t\t\t};\n\t\t}, []);\n\n\t\treturn (\n\t\t\t<div\n\t\t\t\tstyle={{\n\t\t\t\t\twidth: \"100%\",\n\t\t\t\t\theight: \"100%\",\n\t\t\t\t\tposition: \"absolute\",\n\t\t\t\t\tzIndex: 2,\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<canvas\n\t\t\t\t\tref={canvasRef}\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\tleft: \"50%\",\n\t\t\t\t\t\ttop: \"50%\",\n\t\t\t\t\t\tposition: \"absolute\",\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\tThe editor is not supported on this device\n\t\t\t\t</canvas>\n\t\t\t</div>\n\t\t);\n\t},\n);\n\nEditCanvas.displayName = \"EditCanvas\";\n\nexport default EditCanvas;\n","import React, { useEffect, useImperativeHandle, useRef } from \"react\";\nimport { useRecoilState, useRecoilValue } from \"recoil\";\nimport { AppScreens, pageState, variablesState } from \"../helpers/atoms\";\nimport { IS_PROD } from \"../helpers/constants\";\n\ninterface Props {}\n\nconst BackgroundVideo = React.forwardRef<HTMLVideoElement, Props>(\n\t(props, ref) => {\n\t\tconst videoRef = useRef<HTMLVideoElement>(null);\n\n\t\tconst page = useRecoilValue(pageState);\n\t\tconst [variables, setVariables] = useRecoilState(variablesState);\n\n\t\tuseImperativeHandle(ref, () =>\n\t\t\t(videoRef.current!));\n\n\t\tuseEffect(() => {\n\t\t\tconst video = videoRef.current;\n\t\t\tif (!video)\n\t\t\t\treturn;\n\n\t\t\tif (variables.playVideo)\n\t\t\t\tvideo.play();\n\t\t\telse\n\t\t\t\tvideo.pause();\n\n\t\t\t/** Is the tab focused */\n\t\t\tlet focused: boolean = true;\n\t\t\t/** Pause video when not in the tab */\n\t\t\tconst onVisibilityChange = () => {\n\t\t\t\tfocused = (page === AppScreens.EXPORTING) || !focused;\n\t\t\t\tif (!focused)\n\t\t\t\t\tvideo.pause();\n\t\t\t\telse if (variables.playVideo)\n\t\t\t\t\tvideo.play();\n\t\t\t};\n\n\t\t\tif (page !== AppScreens.EXPORTING)\n\t\t\t\tdocument.addEventListener(\"visibilitychange\", onVisibilityChange);\n\n\t\t\t/** Replay video when ended (loop) */\n\t\t\tconst onEnd = () => {\n\t\t\t\tif (page === AppScreens.EXPORTING)\n\t\t\t\t\treturn;\n\n\t\t\t\tvideoRef.current!.currentTime = 0;\n\t\t\t\tvideoRef.current!.play();\n\t\t\t};\n\n\t\t\tif (page !== AppScreens.EXPORTING)\n\t\t\t\tvideo.addEventListener(\"ended\", onEnd);\n\n\t\t\treturn () => {\n\t\t\t\tdocument.removeEventListener(\n\t\t\t\t\t\"visibilitychange\",\n\t\t\t\t\tonVisibilityChange,\n\t\t\t\t);\n\t\t\t\tvideo.removeEventListener(\"ended\", onEnd);\n\t\t\t};\n\t\t}, [variables.playVideo, page]);\n\n\t\tuseEffect(() => {\n\t\t\tconst video = videoRef.current;\n\t\t\tif (!video)\n\t\t\t\treturn;\n\n\t\t\t/** On video loaded and ready to be played */\n\t\t\tconst onReady = () => {\n\t\t\t\tsetVariables((vars) =>\n\t\t\t\t\t({\n\t\t\t\t\t\t...vars,\n\t\t\t\t\t\tplayVideo: true,\n\t\t\t\t\t}));\n\t\t\t};\n\n\t\t\tvideo.addEventListener(\"canplay\", onReady);\n\n\t\t\t// for ios\n\t\t\tvideo.load();\n\n\t\t\treturn () => {\n\t\t\t\tvideo.removeEventListener(\"canplay\", onReady);\n\t\t\t};\n\t\t}, []);\n\n\t\treturn (\n\t\t\t<div>\n\t\t\t\t<video\n\t\t\t\t\tsrc={variables.videoUrl}\n\t\t\t\t\tref={videoRef}\n\t\t\t\t\tmuted={!IS_PROD}\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\tposition: \"absolute\",\n\t\t\t\t\t\tzIndex: 1,\n\t\t\t\t\t\ttop: \"50%\",\n\t\t\t\t\t\tleft: \"50%\",\n\t\t\t\t\t\ttransform: \"translate(-50%, -50%)\",\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t);\n\t},\n);\n\nBackgroundVideo.displayName = \"BackgroundVideo\";\n\nexport default BackgroundVideo;\n","import React, { useEffect, useRef, useState } from \"react\";\nimport { useRecoilValue, useSetRecoilState } from \"recoil\";\n\n// Helpers\nimport { AppScreens, pageState, variablesState } from \"../helpers/atoms\";\n\n// Pages\nimport { DrawPage } from \"../pages/Draw\";\nimport { InitialPage } from \"../pages/Initial\";\nimport { TextPage } from \"../pages/Text\";\n\n// Components\nimport EditCanvas, { IEditCanvasRef } from \"./Canvas\";\nimport BackgroundVideo from \"./Video\";\n\ninterface Props {\n\tvideoUrl: string;\n}\n\nexport const Container: React.FC<Props> = ({ videoUrl }) => {\n\tconst setVariables = useSetRecoilState(variablesState);\n\n\tuseEffect(() => {\n\t\tsetVariables((vars) =>\n\t\t\t({\n\t\t\t\t...vars,\n\t\t\t\tvideoUrl,\n\t\t\t}));\n\t}, []);\n\n\treturn (\n\t\t<div id=\"video_editor_canvas_container_1\">\n\t\t\t<Content />\n\t\t</div>\n\t);\n};\n\nconst Content: React.FC = () => {\n\tconst [started, setStart] = useState<boolean>(false);\n\tconst [loading, setLoading] = useState<boolean>(true);\n\n\tconst canvasRef = useRef<IEditCanvasRef>(null);\n\tconst videoRef = useRef<HTMLVideoElement>(null);\n\n\tconst page = useRecoilValue(pageState);\n\tconst variables = useRecoilValue(variablesState);\n\n\tconst load = () => {\n\t\tsetLoading(false);\n\t};\n\n\tconst start = () =>\n\t\tsetStart(true);\n\n\tuseEffect(() => {\n\t\tload();\n\t}, []);\n\n\tif (loading)\n\t\treturn <span className=\"text-white\">Loading...</span>;\n\n\tif (!started)\n\t\treturn <button onClick={start} type=\"button\">Start</button>;\n\n\tif (variables.exportedVideoUrl)\n\t \treturn (\n\t\t\t<>\n\t\t\t\t<span className=\"text-white\">Exported !</span>\n\t\t\t\t<video src={variables.exportedVideoUrl} style={{ width: 300 }} controls />\n\t\t\t</>\n\t\t);\n\n\treturn (\n\t\t<>\n\t\t\t<div>\n\t\t\t\t<BackgroundVideo ref={videoRef} />\n\t\t\t\t<EditCanvas ref={canvasRef} videoRef={videoRef} />\n\t\t\t</div>\n\t\t\t<div style={{ position: \"relative\", zIndex: 3 }}>\n\t\t\t\t{\n\t\t\t\t\tpage === AppScreens.EXPORTING\n\t\t\t\t\t\t? <span className=\"text-white\">Exporting ...</span>\n\t\t\t\t\t\t: page === AppScreens.INITIAL ? (\n\t\t\t\t\t\t\t<InitialPage canvasRef={canvasRef} videoRef={videoRef} />\n\t\t\t\t\t\t) : page === AppScreens.DRAW ? (\n\t\t\t\t\t\t\t<DrawPage canvasRef={canvasRef} />\n\t\t\t\t\t\t) : page === AppScreens.TEXT ? (\n\t\t\t\t\t\t\t<TextPage canvasRef={canvasRef} />\n\t\t\t\t\t\t) : null\n\t\t\t\t}\n\n\t\t\t</div>\n\t\t</>\n\t);\n};\n","import React from \"react\";\nimport { RecoilRoot } from \"recoil\";\nimport RecoilDebugger from \"recoilize\";\nimport { Container } from \"./components/Container\";\nimport { IS_PROD } from \"./helpers/constants\";\n\nimport \"./VideoEditor.css\";\n\nexport interface EditorProps {\n\tvideoUrl: string\n}\n\nexport const VideoEditor: React.FC<EditorProps> = (args) =>\n\t(\n\t\t<RecoilRoot>\n\t\t\t{/* {!IS_PROD && <RecoilDebugger />} */}\n\t\t\t<Container {...args} />\n\t\t</RecoilRoot>\n\t);\n","import { ReportHandler } from \"web-vitals\";\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n\tif (onPerfEntry && onPerfEntry instanceof Function)\n\t\timport(\"web-vitals\").then(({\n\t\t\tgetCLS, getFID, getFCP, getLCP, getTTFB,\n\t\t}) => {\n\t\t\tgetCLS(onPerfEntry);\n\t\t\tgetFID(onPerfEntry);\n\t\t\tgetLCP(onPerfEntry);\n\t\t\tgetTTFB(onPerfEntry);\n\t\t});\n};\n\nexport default reportWebVitals;\n","import \"react-app-polyfill/stable\";\nimport \"react-app-polyfill/ie11\";\n\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { VideoEditor } from \"./VideoEditor\";\nimport reportWebVitals from \"./reportWebVitals\";\n\n// TODO: add webview interactions and events here (or in an other file)\n\nReactDOM.render(\n\t<React.StrictMode>\n\t\t<VideoEditor videoUrl=\"../src/stories/test.mp4\" />\n\t</React.StrictMode>,\n\tdocument.getElementById(\"root\"),\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}